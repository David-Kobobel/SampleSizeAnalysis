import pandas as pd
import numpy as np
import random
import re
from google.colab import files

uploaded = files.upload()

input_filename = next(iter(uploaded))
print("Uploaded file:", input_filename)

SEED = 2025
N_SAMPLE = 15

df = pd.read_csv(input_filename)

candidate_names = {"doi", "dois"}
doi_cols = [c for c in df.columns if c.strip().lower() in candidate_names]

if not doi_cols:
    doi_pattern = re.compile(r"^10\.\d{4,9}/\S+$")
    best_col = None
    best_rate = 0.0
    for c in df.columns:
        s = df[c].astype(str)
        rate = s.str.match(doi_pattern).mean()
        if rate > best_rate:
            best_rate = rate
            best_col = c
    if best_col is not None and best_rate >= 0.5:
        doi_col = best_col
    else:
        doi_col = df.columns[0]
else:
    doi_col = doi_cols[0]

print("Using DOI column:", doi_col)

doi_df = (
    df[[doi_col]]
    .rename(columns={doi_col: "DOI"})
    .dropna()
    .astype(str)
    .drop_duplicates()
)

if len(doi_df) < N_SAMPLE:
    raise ValueError(f"Requested {N_SAMPLE} but only found {len(doi_df)} unique non-null DOIs.")

np.random.seed(SEED)
random.seed(SEED)

sample_df = doi_df.sample(n=N_SAMPLE, random_state=SEED).reset_index(drop=True)
sample_df.head()

output_filename = f"random_{N_SAMPLE}_dois_seed{SEED}.csv"
sample_df.to_csv(output_filename, index=False)
files.download(output_filename)

